# 智能合规审核系统 - 使用示例

## 启动服务

```bash
cd /Users/robertzf/smart_compliance/backend
uvicorn app:app --reload --port 10000
```

服务启动后，访问 http://localhost:10000/docs 查看完整API文档。

---

## 示例1：查询商务管理员的审核条款

### 请求
```bash
curl "http://localhost:10000/api/match?role=商务管理员&document_type=采购招标/比选/谈判/评审结论建议"
```

### 响应
```json
{
  "role": "商务管理员",
  "document_type": "采购招标/比选/谈判/评审结论建议",
  "matched_clauses": [
    {
      "clause_id": 332,
      "regulation_id": 5,
      "regulation_title": "中华人民共和国政府采购法",
      "clause_number": "第二十八条",
      "content": "第二十八条 采购人不得将应当以公开招标方式采购的货物或者服务化整为零或者以其他任何方式规避公开招标采购。",
      "source": "example",
      "priority": 10
    },
    {
      "clause_id": 342,
      "regulation_id": 5,
      "regulation_title": "中华人民共和国政府采购法",
      "clause_number": "第三十八条",
      "content": "第三十八条 采用竞争性谈判方式采购的，应当遵循下列程序：...",
      "source": "example",
      "priority": 10
    }
  ],
  "total": 2
}
```

### 解读
商务管理员在审核"采购招标/比选/谈判/评审结论建议"单据时，需要关注：
- **第二十八条**：确保采购活动没有规避公开招标
- **第三十八条**：竞争性谈判的程序要求

---

## 示例2：查询厂领导的审核条款

### 请求
```bash
curl "http://localhost:10000/api/match?role=厂领导&document_type=采购招标/比选/谈判/评审结论建议"
```

### 响应
```json
{
  "role": "厂领导",
  "document_type": "采购招标/比选/谈判/评审结论建议",
  "matched_clauses": [
    {
      "clause_id": 340,
      "regulation_id": 5,
      "regulation_title": "中华人民共和国政府采购法",
      "clause_number": "第三十六条",
      "content": "第三十六条 在招标采购中，出现下列情形之一的，应予废标：...",
      "source": "example",
      "priority": 10
    },
    {
      "clause_id": 354,
      "regulation_id": 5,
      "regulation_title": "中华人民共和国政府采购法",
      "clause_number": "第五十条",
      "content": "第五十条 政府采购合同的双方当事人不得擅自变更、中止或者终止合同。...",
      "source": "example",
      "priority": 10
    }
  ],
  "total": 2
}
```

### 解读
厂领导在审核同类单据时，关注点不同：
- **第三十六条**：废标情形的判断
- **第五十条**：合同变更的限制

---

## 示例3：关键词搜索

### 请求
```bash
curl "http://localhost:10000/api/search?keyword=公开招标&limit=5"
```

### 响应
```json
{
  "keyword": "公开招标",
  "results": [
    {
      "clause_id": 11,
      "regulation_title": "淄博市招标投标条例",
      "clause_number": "第十一条",
      "content": "第十一条 国有资金占控股或者主导地位的依法必须进行招标的工程建设项目，应当进行公开招标；有下列情形之一的，可以邀请招标..."
    },
    {
      "clause_id": 16,
      "regulation_title": "淄博市招标投标条例",
      "clause_number": "第十六条",
      "content": "第十六条 公开招标应当依法发布招标公告、编制招标文件。..."
    }
    // ... 更多结果
  ],
  "total": 5
}
```

---

## 示例4：获取所有审核角色

### 请求
```bash
curl "http://localhost:10000/api/roles"
```

### 响应
```json
[
  {
    "id": 1,
    "role_name": "商务管理员",
    "responsibilities": "负责采购招标、比选、谈判等商务活动的合规性审核，确保采购流程符合法律法规要求"
  },
  {
    "id": 2,
    "role_name": "厂领导",
    "responsibilities": "负责重大采购项目的最终审批，把控采购决策的合规性和合理性"
  }
]
```

---

## 示例5：获取所有单据类型

### 请求
```bash
curl "http://localhost:10000/api/document-types"
```

### 响应
```json
[
  {
    "id": 1,
    "type_name": "采购招标/比选/谈判/评审结论建议",
    "description": "采购活动中的招标、比选、谈判等环节的评审结论和建议文档"
  }
]
```

---

## 示例6：获取所有法规文档

### 请求
```bash
curl "http://localhost:10000/api/regulations"
```

### 响应
```json
[
  {
    "id": 1,
    "title": "淄博市招标投标条例",
    "source_file": "../regulations/淄博市招标投标条例_20150522.md",
    "clause_count": 73
  },
  {
    "id": 2,
    "title": "政府投资条例",
    "source_file": "../regulations/政府投资条例_20190414.md",
    "clause_count": 39
  },
  {
    "id": 3,
    "title": "北京市招标投标条例",
    "source_file": "../regulations/北京市招标投标条例_20210924.md",
    "clause_count": 56
  },
  {
    "id": 4,
    "title": "中华人民共和国政府采购法实施条例",
    "source_file": "../regulations/中华人民共和国政府采购法实施条例_20150130.md",
    "clause_count": 99
  },
  {
    "id": 5,
    "title": "中华人民共和国政府采购法",
    "source_file": "../regulations/中华人民共和国政府采购法_20140831.md",
    "clause_count": 91
  },
  {
    "id": 6,
    "title": "中华人民共和国招标投标法",
    "source_file": "../regulations/中华人民共和国招标投标法_20171227.md",
    "clause_count": 69
  }
]
```

---

## 示例7：健康检查

### 请求
```bash
curl "http://localhost:10000/health"
```

### 响应
```json
{
  "status": "healthy",
  "service": "smart_compliance"
}
```

---

## 使用Python测试脚本

系统提供了完整的Python测试脚本，可以一键运行所有测试：

```bash
cd /Users/robertzf/smart_compliance/backend
python test_api.py
```

测试脚本会自动执行：
1. 根路径和健康检查
2. 获取所有角色、单据类型、法规列表
3. 测试商务管理员和厂领导的条款匹配
4. 测试关键词搜索功能

---

## 在浏览器中使用

### Swagger UI（推荐）
访问 http://localhost:10000/docs

在Swagger UI中可以：
- 查看所有API端点
- 直接在浏览器中测试API
- 查看请求/响应的详细格式
- 下载OpenAPI规范文件

### ReDoc
访问 http://localhost:10000/redoc

提供更友好的API文档阅读界面。

---

## 典型使用场景

### 场景1：新员工培训
**需求**：新入职的商务管理员需要了解审核采购招标单据时要关注哪些法规条款。

**操作**：
```bash
curl "http://localhost:10000/api/match?role=商务管理员&document_type=采购招标/比选/谈判/评审结论建议"
```

**结果**：系统返回该角色需要关注的所有相关条款。

### 场景2：快速查询法规
**需求**：在审核过程中，需要快速查找包含"废标"关键词的所有法规条款。

**操作**：
```bash
curl "http://localhost:10000/api/search?keyword=废标&limit=20"
```

**结果**：系统返回所有包含"废标"的条款列表。

### 场景3：了解系统数据
**需求**：查看系统中有哪些法规文档和多少条款。

**操作**：
```bash
curl "http://localhost:10000/api/regulations"
```

**结果**：系统返回所有法规的摘要信息，包括条款数量。

---

## 错误处理示例

### 示例：角色不存在
```bash
curl "http://localhost:10000/api/match?role=不存在的角色&document_type=采购招标/比选/谈判/评审结论建议"
```

**响应**：
```json
{
  "detail": "未找到审核角色: 不存在的角色"
}
```
HTTP状态码：404

### 示例：单据类型不存在
```bash
curl "http://localhost:10000/api/match?role=商务管理员&document_type=不存在的单据"
```

**响应**：
```json
{
  "detail": "未找到单据类型: 不存在的单据"
}
```
HTTP状态码：404

---

## 性能说明

- **响应时间**：通常 < 50ms
- **并发支持**：支持多个并发请求
- **数据库**：SQLite，适合中小规模数据
- **扩展性**：可轻松切换到PostgreSQL等企业级数据库

---

## 下一步

1. **添加更多数据**：扩展审核角色、单据类型和审核规则
2. **优化匹配**：引入语义匹配和智能推荐
3. **开发前端**：创建用户友好的Web界面
4. **集成LLM**：利用大语言模型提供智能审核建议

---

**文档版本**：1.0.0  
**更新日期**：2025-12-31  
**服务端口**：10000
